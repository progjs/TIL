# 10/06 화



### VPC (Virtual Private Cloud)

- 네트워크 계층

- EC2 인스턴스를 비롯한 여러 AWS 서비스의 리소스를 담을 수 있는 ***가상 네트워크***

- 한 AWS 리전 안에서만 존재할 수 있고, 한 리전에 만든 VPC는 다른리전에서는 보이지 않는다.

- 연속적인 IP 주소 범위로 구성 => CIDR 블록으로 표시

  - 10.0.0.0/8 => 10.0.0.0 ~ 10.255.255.255
  - 172.16.0.0/12 => 172.16.0.0 ~ 172.31.255.255
  - 192.168.0.0/16 => 192.168.0.0 ~ 192.168.255.255

  [^IP 설명]: 172.16.0.0/16에서 1111 1111 1111 1111 0000 0000 0000 0000 이런식이라서 0,8,16,24 이렇게 되는 것
  [^CIDR]: 사이더. 옥텟(Octet)과 구분자(.)으로 ip를 표기하는 방법. 1옥텟=1byte=0~255까지 표현 가능. ip는 총 4byte(32bit)

  ![img](E:/aws/images/ip.png)<https://blog.naver.com/ncloud24/221208338209>



### 서브넷 (subnet)

- VPC 내부의 논리 컨테이너

- EC2 인스턴스를 배치하는 장소 = 인스턴스는 서브넷 안에 위치함

  - 한번 서브넷에 인스턴스를 생성하면 다른 서브넷으로 옮길 수 없음
  - 인스턴스를 종료하고 다른 서브넷에 새 인스턴스를 만들 수는 있다.

- 장점과 역할: 인스턴스를 서로 격리하고, 인스턴스 간의 트래픽 흐름을 제어하고, 인스턴스를 기능별로 묶을 수 있다.

- 서브넷 CIRD 블록

  - VPC의 일부, VPC 내에서는 유니크해야 한다.

  - 모든 서브넷에서 처음 4개의 IP와 마지막 1개는 예약되어 있으므로 인스턴스에 할당할 수 없다.

    EX) 서브넷 CIDR이 172.16.100.0/24 일 때, 

    172.16.100.0 ~ 172.16.100.3과 172.16.100.255는 인스턴스에 할당할 수 없다.

- 서브넷은 하나의 가용 영역(Availability Zone, AZ) 내에서만 존재할 수 있다.

  - (가용 영역이 필요한 이유: 하나의 가용영역(서브넷)이 망가졌을 때 다른 가용영역의 서브넷으로 대체하여 사용하기 위해)





#### ENI (Elastic Network Interface: 탄력적 네트워크 인터페이스) 

- 물리 서버의 네트워크 인터페이스와 같은 기능을 수행



#### 인터넷 게이트웨이 (igw)

- 퍼블릭 IP 주소를 할당받은 인스턴스가 인터넷과 연결되어 요청을 수신할 수 있도록 기능을 제공

  - 퍼블릭 IP를 할당: 외부에서 접근가능하도록(식별할 수 있도록) 하는 것.

    **단, 퍼블릭 IP주소가 igw와 연결되어 있어야만 접근 가능.**

- 처음 VPC를 만들면 인터넷 게이트웨이가 연결되어 있지 않으므로, 직접 인터넷 게이트웨이를 만들고 VPC와 연결해야 한다.

- 하나의 VPC는 하나의 인터넷 게이트웨이만 연결할 수 있다.



#### 라우팅

- VPC는 소프트웨어 함수로 IP 라우팅을 구현 => 사용자는 라우팅 테이블만 관리하면 된다.

- 라우팅 테이블 => 하나 이상의 라우팅과 하나 이상의 서브넷 연결로 구성

- **기본 라우팅** : 인터넷 게이트웨이를 가리키는 라우팅

  대상주소										대상

  0.0.0.0/0 								igw-xxxxxxx  - 인터넷 게이트웨이

  L 인터넷상의 모든 호스트 IP를 기반으로 한다.

- 기본 라우팅이 포함된 라우팅 테이블과 연결된 서브넷 => Public Subnet

- 기본 라우팅이 포함된 라우팅 테이블과 연결되지 않은 서브넷 => Private Subnet

  대상주소										대상

  172.31.0.0/16							 LOCAL

  0.0.0.0/0									igw-xxxxxxx

  198.51.100.50으로 패킷을 보내려고 하면,

  라우팅할 위치와 가장 근접하게 일치하는 항목을 기반으로 라우팅을 처리하므로, 인터넷 게이트웨이로 라우팅된다.

  => 라우팅 테이블의 항목들간의 순서는 중요하지 않다.



#### 보안그룹

- 방화벽과 같은 기능을 제공

- 인스턴스의 ENI에서 송수신하는 트래픽을 허가해서 트래픽을 제어

- 모든 ENI는 하나이상의 보안그룹과 연결되어야 하고, 

  보안그룹은 여러 ENI와 연결될 수 있다.

- 생성할 때 보안그룹의 이름, 설명, 포함될 VPC를 지정하고,

  생성 후에 인바운드, 아웃바운드 규칙을 지정한다.				=> 트래픽을 허용

- 상태 저장 방화벽 역할 => 보안 그룹이 트래픽을 한 방향으로 전달되도록 허용할 때 반대 방향의 응답 트래픽을 지능적으로(자동으로) 허용.

  EX) 웹 클라이언트에서 HTTPS로 요청을 허용했다면 요청에 대한 응답도 허용

[^인바운드]: 서버나 네트워크 내부로 들어오는 것 (자신의 컴퓨터로 들어오기 시작하는 네트워크 데이터)
[^아웃바운드]: 서버 밖으로 나가는 것 (서버나 네트워크 존 외부로 데이터 송출)



#### NACL (Network Access Control List)

- 보안 그룹과 유사
  - 원본 또는 대상 주소 CIDR, 프로토콜, 포트를 기반으로 트래픽을 인바운드, 아웃바운드 규칙으로 제어 => 방화벽과 같은 역할
  - VPC에 삭제할 수 없는 기본 NACL이 있다.
- 서브넷에 연결되어 해당 서브넷과 송수신되는 트래픽을 제어한다.
- 상태 비저장 (**보안그룹과의 차이점**)
  - NACL을 통과한 연결 상태를 추적하지 않는다.
  - 모든 인바운드와 아웃바운드 트래픽의 허용 규칙을 별도로 작성해야 한다.



# 10.08 목



## SNS

- 주제 (topic)

- 구독 ( subscribe) - (구독의 프로토콜: 이메일, SMS, ... Lambda)

- 메시지 개시

  주제를 구독된 곳으로 메시지 개시(전달한다)



##### 이메일로 구독할 때

반드시 이메일계정에서 구독을 확인해야 한다.







# 10/12 월



## EC2로 nginx 구동하기

#### EC2 생성

#### nginx 다운로드

#### nginx 명령어 간소화

#### nginx 자동 시작 설정

#### 하나의 서버에서 2개의 앱 서비스



### Auto Scaling

하나의 서비스는 여러대의 서버 인스턴스로 서비스하여, 많은 트래픽에 대응하고 서버에 장애가 발생해도 서비스가 안전하게 운영될 수 있도록 한다.

(서비스 가용성을 높이고, 부하와 연산을 분산시킨다)

#### Auto Scaling 그룹

같은 사양, 환경, 코드를 가진 똑같은 EC2 인스턴스들의 묶음

- **자원 사용량**을 기준으로 자동 조정

  클라이언트 요청량이 많아져서 CPU의 평균 사용량이 많을 때, 여러개의 인스턴스가 나눠서 처리함으로써 평균 CPU 사용량을 정상범위로 낮추는 방법

- **시간**을 기준으로 자동 조정

  소셜커머스처럼 서비스의 특성상 자정에만 클라이언트 사용량이 많은 경우, 자정에만 서버 인스턴스를 여러대 실행한다. 이렇게 시간을 기준으로 실행중인 인스턴스의 개수를 자동 조정하는 방법.

##### Auto Scaling 그룹 생성 방법

- **시작 템플릿 (Launch Template)**으로 설정하여 그룹을 만든다.
- 시작 템플릿이란 사양, 보안그룹, 네트워크 설정 등 인스턴스를 어떻게 설정하여 시작(띄울지)할지 미리 정의해두는 템플릿



### 로드 밸런서와 대상 그룹

#### 로드 밸런서 (Load Balancer)

- 트래픽(부하)을 (auto scaling 그룹에 포함되어 있는) EC2 인스턴스에 분산시켜 라우팅하는 기능

- 로드 밸런서는 auto scaling 그룹이나 인스턴스에 부하를 분산시켜 로드 밸런싱한다.

- 자신이 로드 밸런싱할 인스턴스들의 상태(동작여부)를 수시로 확인해야 한다.

  => **health check**

  - 이로 인해 일부 서버 인스턴스에 장애가 발생해도, 해당 인스턴스가 정상 상태로 복귀할 때까지 클라이언트의 요총을 전달하지 않는 기능이 있다.

- 클라이언트 -> 로드 밸런서 -> (auto scaling 그룹) -> EC2 인스턴스



#### 장애 조치

- 시스템의 일부 서버에 장애가 발생했을 때, 예비 시스템이 즉시 요청을 대신 처리해서 다운타임을 최소화하는 것이다.
- 운영 서버라면 꼭 서버를 2대 이상 띄워서 장애 조치가 가능하도록 처리해야 한다.
- Auto Scaling 그룹과 로드 밸런서로 장애 조치를 구현할 수 있다.

##### 실습

**대상 그룹의 상태검사 항목들**

-- 경로

-- 정상 임계 값(healthy threshold)

-- 비정상 임계값

-- 제한시간(time out)

-- 간격(몇 초 간격으로 인스턴스의 상태를 물어볼지)

-- 성공코드(200 OK)

=> (5+2) *2 = 14초 안에 인스턴스 상태를 판별 가능